---
tags: [通信]
title: 定点数
created: '2019-12-04T00:39:23.060Z'
modified: '2019-12-04T02:49:54.622Z'
---

# 定点数

## 定点数的格式

定点数的格式写成(s, wl, fl)的形式，其中：

* s：是不是有符号数。1代表有符号数，0代表无符号数。
* wl：总位宽，最小可以等于1。定点数的可能取值个数为$2^{wl}$。比如：
  * (1,1,0)表示1bit整数，可能取的值是[-1, 0]
  * (0,1,0)表示1bit整数，可能取的值是[0, 1]。
* fl：小数点位置，可以是任意整数。定点数的分辨率为$2^{-fl}$。比如：
  * (1,2,1)的分辨率为$2^{-1}=0.5$，可取的值是[-1, -0.5, 0, 0.5]
  * (1,2,2)的分辨率为$2^{-2}=0.25$，可取的值是[-0.5, -0.25, 0, 0.25]
  * (1,2,-1)的分辨率为$2^1=2$，可取的值是[-4, -2, 0, 2]
* 对有符号定点数，最小值是$-2^{wl-fl-1}$，最大值是$2^{wl-fl-1}-2^{-fl}$
* 对无符号定点数，最小值是0，最大值是$2^{wl-fl}-2^{-fl}$

## 定点数的计算

两个有符号定点数x和y，格式都为(1, wl, fl)：

* $x \pm y$的结果可以用格式为(1, wl+1, fl)的定点数存放
* $x \times y$的结果可以用格式为(1, 2\*wl-1, 2\*fl)的定点数存放，==当x和y都取最小值时会溢出==
* $x^2$的结果可以用格式为(0, 2\*wl-2, 2\*fl)的定点数存放，==当x取最小值时会溢出==

两个无符号定点数x和y，格式都为(0, wl, fl)：

* $x \pm y$的结果可以用格式为(0, wl+1, fl)的定点数存放
* $x \times y$的结果可以用格式为(0, 2\*wl, 2\*fl)的定点数存放
* $x^2$的结果可以用格式为(0, 2\*wl, 2\*fl)的定点数存放

## 定点数的转换

定点数转换的步骤如下：

1. 对齐转换前后格式的小数点
2. 处理高位bit的变化
   * 要增加，就补0
   * 要减少，就舍入。常见的舍入方法有：round、floor、ceil。floor的硬件实现最简单。round和ceil都有可能导致溢出，必须加保护。
3. 处理低位bit的变化
   * 要增加，有符号数就补符号位，无符号数就补0
   * 要减少，就饱和(saturate)或绕回(wrap)。wrap的硬件实现最简单。wrap等价于求模运算。

注意，对低位bit的round或ceil必须先于对高位的wrap，不然有可能得到错误的结果。
注意，先对低位bit做round或ceil，后对高位bit做saturate或wrap，可以省略round或ceil的溢出保护。
